local boards = require 'boards'

local files = {}

local offset = { x = 0, y = 0 }

local args = {...}
local i = 1
while i <= #args do
	local arg = args[i]
	if arg=='-offset' then
		i = i + 1
		assert(i <= #args, "-offset need an argument")
		local sx,x,sy,y = args[i]:match('^([+-])([%d.]+)([+-])([%d.]+)$')
		assert(sx and x and sy and y)
		x,y = tonumber(x),tonumber(y)
		assert(x and y)
		if sx=='-' then x = -x end
		if sy=='-' then y = -y end
		offset = { x = x, y = y }
	elseif arg:match('^%-') then
		error("unknown option "..arg)
	else
		table.insert(files, {filename=arg, scale=scale, offset=offset})
	end
	i = i + 1
end

local output = files[#files].filename
files[#files] = nil

-- load files
for _,file in ipairs(files) do
	print("loading "..file.filename)
	file.board = boards.offset(assert(boards.load(file.filename)), file.offset.x, file.offset.y)
end

-- merge files
local merged = files[1].board
for i=2,#files do
	merged = boards.merge(merged, files[i].board)
end

-- save output file
assert(boards.save(merged, output))

-- vi: ft=lua
